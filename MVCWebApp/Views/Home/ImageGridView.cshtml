@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@using Microsoft.Extensions.FileProviders;
@model IEnumerable<IFileInfo>

@{
    ViewData["Title"] = "Images";
}

<h1 class="text-center">Images (of Gourock mostly)</h1>


<div id="loader" class="loader"></div>


<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div><span class="close">&times;</span></div>
        
        <img class="modal-img" id="imgModal" src="~/images/s_50.png"  />
    </div>

</div>

<div id="pane" class="grid-container grid-container--fit d-none">

    @foreach (var item in Model.Where(x => x.IsDirectory != true))
    {
        <div class="grid-element">

            <div class="card">
                <img loading="lazy" class="card--avatar" src="~/images/gridImages/@item.Name">
                <h3 class="card--title">@item.Name</h3>
                <button class="card--link" onclick="showModal(this)">View</button>
                @*<a class="card--link" asp-action="" asp-route-filename="@Url.Content(item.PhysicalPath)">View</a>
            *@
            </div>


        </div>

    }
</div>

<script>
    $("img").ready(function() {
        $('#loader').addClass("d-none");
        $('#pane').removeClass("d-none");

        // Get the <span> element that closes the modal
        var span = $('.close')[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            $('#myModal').hide();
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(e) {
            console.log(e);

            if (e.target.id === 'myModal') {
                $('#myModal').hide();
            }
        }

    });

    function showModal(e) {
        var fName = $(e).siblings()[0].attributes[1].textContent;

        $('#imgModal').attr('src', fName);

        if (window.innerWidth > 768) {
            
            var img = $("#imgModal");
            // Create dummy image to get real width and height
            $("<img>").attr("src", $(img).attr("src")).load(function() {

                var realWidth = this.width;
                var realHeight = this.height;
                var ratio = realHeight / realWidth;

                //var imgWidth = $($('#imgModal')[0]).width();
                var imgHeight = $($('#imgModal')[0]).height();
                $($('div.modal-content')[0]).width(imgHeight / ratio);
                $($('div.modal-content')[0]).height(imgHeight + 40);

                $('#myModal').show();

            });

        } else {

            $('#myModal').show();
        }
        

    }


</script>

<style>

    :root {
        --blue: #1e90ff;
        --white: #ffffff;
        --mySize: 20rem;
    }

    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 50px; /* Location of the box */
        margin:auto;
        top: 0;
        left: 0;
        width: 100%;  
        height: 100%;         
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }
    /* Modal Content */
    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 0px 20px 20px;
        border: 1px solid #888;
        width: 80%;
    }
    .modal-img{ 
  
        height:80vh;
        object-fit:contain;
        
    }

    @@media only screen and (max-width: 768px) {
       
        .modal-img {
              width: 100%;
              height: auto;        
              /*object-fit:contain;*/

        }
    }

    .close {
        color: #aaaaaa;
        float:right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover, .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }

    .grid-container {
        display: grid;
    }

    .grid-container--fill {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }

    .grid-container--fit {
        grid-template-columns: repeat(auto-fit, minmax(var(--mySize), 1fr));
    }

    .grid-element {
        background-color: gainsboro;
        padding: 20px;
        color: #fff;
        border: 1px solid #fff;
    }

    .card {
        display: flex;
        align-items: center;
        flex-direction: column;
        width: var(--mySize) auto;
        height: auto;
        background: #fff;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
        border-radius: 10px;
        margin: auto;
        overflow: hidden;
        padding-bottom: 0.6rem;
    }

    .card--avatar {
        width: 100%;
        height: auto;
        object-fit: cover;
    }

    .card--title {
        color: #222;
        font-weight: 700;
        text-transform: capitalize;
        font-size: 1.1rem;
        margin-top: 0.5rem;
    }

    .card--link {
        text-decoration: none;
        background: #db4938;
        color: #fff;
        padding: 0.3rem 1rem;
        border-radius: 20px;
    }
    .card--link:hover, .card--link:focus {
        background-color: pink;
        color: white;

    }

    .loader {
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 80px;
        height: 80px;
        position: absolute;
        top: calc(50% - 40px);
        left: calc(50% - 40px);
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

</style>

